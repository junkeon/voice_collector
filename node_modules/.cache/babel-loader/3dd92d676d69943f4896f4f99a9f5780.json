{"ast":null,"code":"import _objectSpread from\"/home/jkpark/Documents/react/voice-collector/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/jkpark/Documents/react/voice-collector/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{React,useRef,useEffect,useState}from\"react\";import{Grid,IconButton,Typography}from'@material-ui/core';import ChevronLeftIcon from'@material-ui/icons/ChevronLeft';import ChevronRightIcon from'@material-ui/icons/ChevronRight';import MicIcon from'@material-ui/icons/Mic';import{useReactMediaRecorder}from\"react-media-recorder\";import WaveSurfer from\"wavesurfer.js\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function Record(_ref){var recipeUrl=_ref.recipeUrl,classes=_ref.classes,sentList=_ref.sentList,setSentList=_ref.setSentList,index=_ref.index,setIndex=_ref.setIndex,user=_ref.user;var media=useReactMediaRecorder({audio:true,onStop:function onStop(a,b){setblob(b);}});var _useState=useState(''),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),recBtn=_useState4[0],setRecBtn=_useState4[1];var waveformRef=useRef();var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),blob=_useState6[0],setblob=_useState6[1];var _useState7=useState({'color':'disabled','disabled':true}),_useState8=_slicedToArray(_useState7,2),decBtnState=_useState8[0],setDecState=_useState8[1];var _useState9=useState('action'),_useState10=_slicedToArray(_useState9,2),iconColor=_useState10[0],setIconColor=_useState10[1];var _useState11=useState({'color':'inherit','disabled':false}),_useState12=_slicedToArray(_useState11,2),incBtnState=_useState12[0],setIncState=_useState12[1];var _useState13=useState(\"Ready to record\"),_useState14=_slicedToArray(_useState13,2),statusMSG=_useState14[0],setStatusMSG=_useState14[1];var _useState15=useState('block'),_useState16=_slicedToArray(_useState15,2),statusVis=_useState16[0],setStatusVis=_useState16[1];var _useState17=useState('none'),_useState18=_slicedToArray(_useState17,2),waveVis=_useState18[0],setWavVis=_useState18[1];var totalNumber=sentList.length;useEffect(function(){if(waveformRef.current&&blob!==''){blobToBase64(recipeUrl,blob);var wavesurfer=WaveSurfer.create({container:waveformRef.current,waveColor:'blue',barWidth:2,barMinHeight:1,cursorColor:'transparent',progressColor:'blue'// scrollParent:true\n});wavesurfer.loadBlob(blob);return function(){wavesurfer.destroy();};}},[blob]);useEffect(function(){if(text!==''){var check=window.confirm('음성 인식 결과 : \\n'+text);if(check){setSentList(sentList.map(function(item){return item.id===index?_objectSpread(_objectSpread({},item),{},{done:true}):item;}));changeSent('+');}}setStatusMSG(\"Ready to record\");setStatusVis('block');setWavVis('none');},[text]);useEffect(function(){if(index===0){setDecState({'color':'disabled','state':true});}else{setDecState({'color':'inherit','state':false});}if(index===sentList.length-1){setIncState({'color':'disabled','state':true});}else{setIncState({'color':'inherit','state':false});}},[index]);function blobToBase64(recipeUrl,blob){console.log('Connect to server...');var reader=new FileReader();reader.onload=function(){var dataUrl=reader.result;var base64=dataUrl.split(',')[1];sendToOffline(base64);getScript(recipeUrl,base64,index,user,sentList[index].text);};reader.readAsDataURL(blob);};function sendToOffline(b64data){var recipeUrl=\"https://ai-demo.tmaxos.com/xwpqe/restasr/\";var postBody={'uuid':'restasr','data':b64data};var requestMetadata={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(postBody)};fetch(recipeUrl,requestMetadata).then(function(res){return res.json();}).then(function(res){return setText(res.text);});}function getScript(recipeUrl,b64data,index,user,scp){// const recipeUrl = \"http://0.0.0.0:5024/send_audio\"\nvar postBody={'user':user,'blob':b64data,'index':index,'sent':scp};var requestMetadata={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(postBody)};fetch(recipeUrl+'/send_audio',requestMetadata).then(function(res){return res.json();});}function record(){if(recBtn){media.startRecording();setIconColor('secondary');setStatusMSG('Recording...');setDecState({'color':'disabled','state':true});setIncState({'color':'disabled','state':true});}else{media.stopRecording();setIconColor('action');setStatusMSG('Ready to record');setStatusVis('none');setWavVis('block');if(index===0){setDecState({'color':'disabled','state':true});}else{setDecState({'color':'inherit','state':false});}if(index===sentList.length-1){setIncState({'color':'disabled','state':true});}else{setIncState({'color':'inherit','state':false});}}setRecBtn(!recBtn);}function changeSent(direc){if(direc==='+'){if(index<sentList.length-1){setIndex(index+1);}}else if(direc==='-'){if(index>0){setIndex(index-1);}}setIconColor('action');setStatusMSG('Ready to record');setStatusVis('block');setWavVis('none');}return/*#__PURE__*/_jsxs(\"div\",{className:classes.content,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.index,children:/*#__PURE__*/_jsxs(Typography,{variant:\"h5\",children:[sentList[index].done?'Done - ':'Undone - ',index+1,\" / \",totalNumber]})}),/*#__PURE__*/_jsx(\"div\",{className:classes.parSentence,children:/*#__PURE__*/_jsx(\"div\",{className:classes.sentence,children:sentList[index].text.split('\\n').map(function(line,idx){return/*#__PURE__*/_jsx(Typography,{variant:\"h4\",style:{paddingTop:7,paddingBottom:7},children:line},idx);})})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.visual,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.status,style:{display:statusVis},children:/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:statusMSG})}),/*#__PURE__*/_jsx(\"div\",{ref:waveformRef,className:classes.waveform,style:{display:waveVis}})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.control,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:true,className:classes.grid,children:/*#__PURE__*/_jsx(IconButton,{onClick:function onClick(){changeSent('-');},disabled:decBtnState['state'],children:/*#__PURE__*/_jsx(ChevronLeftIcon,{fontSize:\"large\",className:classes.controlBtn,color:decBtnState['color']})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:true,className:classes.grid,children:/*#__PURE__*/_jsx(IconButton,{onClick:record,children:/*#__PURE__*/_jsx(MicIcon,{fontSize:\"large\",className:classes.controlBtn,color:iconColor})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:true,className:classes.grid,children:/*#__PURE__*/_jsx(IconButton,{onClick:function onClick(){changeSent('+');},disabled:incBtnState['state'],children:/*#__PURE__*/_jsx(ChevronRightIcon,{fontSize:\"large\",className:classes.controlBtn,color:incBtnState['color']})})})]})})]});}export default Record;","map":{"version":3,"sources":["/home/jkpark/Documents/react/voice-collector/src/components/RecordDiv.js"],"names":["React","useRef","useEffect","useState","Grid","IconButton","Typography","ChevronLeftIcon","ChevronRightIcon","MicIcon","useReactMediaRecorder","WaveSurfer","Record","recipeUrl","classes","sentList","setSentList","index","setIndex","user","media","audio","onStop","a","b","setblob","text","setText","recBtn","setRecBtn","waveformRef","blob","decBtnState","setDecState","iconColor","setIconColor","incBtnState","setIncState","statusMSG","setStatusMSG","statusVis","setStatusVis","waveVis","setWavVis","totalNumber","length","current","blobToBase64","wavesurfer","create","container","waveColor","barWidth","barMinHeight","cursorColor","progressColor","loadBlob","destroy","check","window","confirm","map","item","id","done","changeSent","console","log","reader","FileReader","onload","dataUrl","result","base64","split","sendToOffline","getScript","readAsDataURL","b64data","postBody","requestMetadata","method","headers","body","JSON","stringify","fetch","then","res","json","scp","record","startRecording","stopRecording","direc","content","parSentence","sentence","line","idx","paddingTop","paddingBottom","visual","status","display","waveform","control","grid","controlBtn"],"mappings":"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","sourcesContent":["\nimport { React, useRef, useEffect, useState } from \"react\";\nimport { Grid, IconButton, Typography } from '@material-ui/core';\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport MicIcon from '@material-ui/icons/Mic';\n\nimport { useReactMediaRecorder } from \"react-media-recorder\";\nimport WaveSurfer from \"wavesurfer.js\";\n\nfunction Record({ recipeUrl, classes, sentList, setSentList, index, setIndex, user }) {\n\n    const media = useReactMediaRecorder({ audio: true, onStop: (a, b) => { setblob(b) } })\n    const [text, setText] = useState('')\n    const [recBtn, setRecBtn] = useState(true)\n\n    const waveformRef = useRef();\n    const [blob, setblob] = useState('');\n\n    const [decBtnState, setDecState] = useState({ 'color': 'disabled', 'disabled': true })\n    const [iconColor, setIconColor] = useState('action')\n    const [incBtnState, setIncState] = useState({ 'color': 'inherit', 'disabled': false })\n\n    const [statusMSG, setStatusMSG] = useState(\"Ready to record\")\n    const [statusVis, setStatusVis] = useState('block')\n    const [waveVis, setWavVis] = useState('none')\n\n    const totalNumber = sentList.length\n\n    useEffect(() => {\n        if (waveformRef.current && blob !== '') {\n            blobToBase64(recipeUrl, blob);            \n            const wavesurfer = WaveSurfer.create({\n                container: waveformRef.current,\n                waveColor: 'blue',\n                barWidth: 2,\n                barMinHeight: 1,\n                cursorColor: 'transparent',\n                progressColor: 'blue',\n                // scrollParent:true\n            });\n\n            wavesurfer.loadBlob(blob);\n\n            return () => {\n                wavesurfer.destroy()\n            }\n        }\n    }, [blob]);\n\n    useEffect(() => {\n        if (text !== '') {\n            var check = window.confirm('음성 인식 결과 : \\n' + text)\n            if (check) {\n                setSentList(sentList.map(item => item.id === index ? { ...item, done: true } : item))\n                changeSent('+')                \n            }\n        }\n        setStatusMSG(\"Ready to record\")\n        setStatusVis('block')\n        setWavVis('none')\n    }, [text])\n\n    useEffect(() => {\n        if (index === 0) {\n            setDecState({ 'color': 'disabled', 'state': true })\n        } else {\n            setDecState({ 'color': 'inherit', 'state': false })\n        }\n\n        if (index === sentList.length - 1) {\n            setIncState({ 'color': 'disabled', 'state': true })\n        } else {\n            setIncState({ 'color': 'inherit', 'state': false })\n        }\n    }, [index])\n\n    function blobToBase64(recipeUrl, blob) {\n        console.log('Connect to server...')\n        var reader = new FileReader();\n        reader.onload = function () {\n            var dataUrl = reader.result;\n            var base64 = dataUrl.split(',')[1];\n            sendToOffline(base64);\n            getScript(recipeUrl, base64, index, user, sentList[index].text)\n        };\n        reader.readAsDataURL(blob);\n    };\n\n    function sendToOffline(b64data) {\n        const recipeUrl = \"https://ai-demo.tmaxos.com/xwpqe/restasr/\"\n        const postBody = {\n            'uuid': 'restasr',\n            'data': b64data\n        }\n        const requestMetadata = {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(postBody)\n        };\n\n        fetch(recipeUrl, requestMetadata).then(res => res.json()).then(res => setText(res.text))\n    }\n\n    function getScript(recipeUrl, b64data, index, user, scp) {\n        // const recipeUrl = \"http://0.0.0.0:5024/send_audio\"\n        const postBody = {\n          'user': user,\n          'blob': b64data,\n          'index' : index,\n          'sent' : scp,\n        }\n        const requestMetadata = {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(postBody)\n        };\n    \n        fetch(recipeUrl + '/send_audio', requestMetadata)\n        .then(res => res.json())\n      }\n\n    function record() {\n        if (recBtn) {\n            media.startRecording();\n            setIconColor('secondary');\n            setStatusMSG('Recording...')\n            setDecState({ 'color': 'disabled', 'state': true })\n            setIncState({ 'color': 'disabled', 'state': true })\n        } else {\n            media.stopRecording();\n            setIconColor('action');\n            setStatusMSG('Ready to record')\n            setStatusVis('none')\n            setWavVis('block')\n            if (index === 0) {\n                setDecState({ 'color': 'disabled', 'state': true })\n            } else {\n                setDecState({ 'color': 'inherit', 'state': false })\n            }\n\n            if (index === sentList.length - 1) {\n                setIncState({ 'color': 'disabled', 'state': true })\n            } else {\n                setIncState({ 'color': 'inherit', 'state': false })\n            }\n\n\n        }\n        setRecBtn(!recBtn);\n    }\n\n    function changeSent(direc) {\n        if (direc === '+') {\n            if (index < sentList.length - 1) {\n                setIndex(index + 1)\n            }\n        } else if (direc === '-') {\n            if (index > 0) {\n                setIndex(index - 1)\n            }\n        }\n        setIconColor('action');\n        setStatusMSG('Ready to record')\n        setStatusVis('block')\n        setWavVis('none')\n    }\n\n    return (\n        <div className={classes.content}>\n            <div className={classes.index}>\n                <Typography variant=\"h5\">\n                    {sentList[index].done ? 'Done - ' : 'Undone - '}\n                    {index + 1} / {totalNumber}\n                </Typography>\n            </div>\n            <div className={classes.parSentence}>\n                <div className={classes.sentence}>\n                    {sentList[index].text.split('\\n').map((line, idx) => {\n                        return <Typography key={idx} variant=\"h4\" style={{paddingTop:7, paddingBottom : 7}}>{line}</Typography>\n                    })}\n                </div>\n            </div>\n            <div className={classes.visual}>\n                <div className={classes.status} style={{ display: statusVis }}>\n                    <Typography variant=\"h4\">{statusMSG}</Typography>\n                </div>\n                <div ref={waveformRef} className={classes.waveform} style={{ display: waveVis }}></div>\n            </div>\n            <div className={classes.control}>\n                <Grid container spacing={2}>\n                    <Grid item xs className={classes.grid}>\n                        <IconButton\n                            onClick={() => { changeSent('-') }}\n                            disabled={decBtnState['state']}>\n                            <ChevronLeftIcon\n                                fontSize=\"large\"\n                                className={classes.controlBtn}\n                                color={decBtnState['color']} />\n                        </IconButton>\n                    </Grid>\n                    <Grid item xs className={classes.grid}>\n                        <IconButton onClick={record}><MicIcon fontSize=\"large\" className={classes.controlBtn} color={iconColor} /></IconButton>\n                    </Grid>\n                    <Grid item xs className={classes.grid}>\n                        <IconButton\n                            onClick={() => { changeSent('+') }}\n                            disabled={incBtnState['state']}>\n                            <ChevronRightIcon\n                                fontSize=\"large\"\n                                className={classes.controlBtn}\n                                color={incBtnState['color']} />\n                        </IconButton>\n                    </Grid>\n                </Grid>\n            </div>\n        </div >\n    )\n}\n\nexport default Record"]},"metadata":{},"sourceType":"module"}